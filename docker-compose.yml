version: '2.2'

services:

  consul:
    image: consul:latest
    command: agent -server -bootstrap -client=0.0.0.0 -bind=127.0.0.1
    ports:
      - "8500:8500"
    
  silo:
    image: silo
    build:
      context: .
      dockerfile: Dockerfile-Silo
    depends_on:
      - consul
      - storage
    ports:
      - "8080"
    links:
      - consul
    cpu_count: 2
      
      
  storage:
    image: redis:alpine
    command: --dbfilename dump.rdb --dir /data 
    volumes:
      - ../data:/data
    
  frontendweb:
    image: frontendweb
    build:
      context: .
      dockerfile: Dockerfile-Frontend-Web
    depends_on:
      - silo
    ports:
      - "5000:80"
    links:
      - silo
      - consul
        
  cli:
      image: cli
      build:
        context: .
        dockerfile: Dockerfile-CLI
      depends_on:
        - silo
      volumes:
        - ../exportcli:/exportcli
      links:
        - silo
        - consul
      cpu_count: 2